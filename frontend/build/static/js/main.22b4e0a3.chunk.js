(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{214:function(e,t,n){e.exports=n(339)},220:function(e,t,n){},326:function(e,t){},339:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(21),l=n(2),c=n.n(l),s=n(6),i=n(15),u=n(22),m=n(25),h=n(23),d=n(26),p=(n(220),function(){localStorage.removeItem("token"),localStorage.removeItem("expiry")}),g=function(){var e=localStorage.getItem("expiry");return!!e&&+new Date(e)>+new Date},b=n(42),f=n(16),v={background:"#FFF",height:"64px",paddingRight:"20px"},C=(n(71),n(112)),E={styleButton:{margin:"0px 50px 10px auto",fontWeight:"800",padding:"5px",border:"#1565C0",borderStyle:"solid",borderRadius:"10%",backgroundColor:"#EA9A40"}},S=Object(C.a)({transition:"color .2s",color:"black",$nest:{"&:hover":{color:"white"}}}),y=function(e){return a.createElement(b.b,Object.assign({to:"/load"},e))},w=function(e){return a.createElement(b.b,Object.assign({to:"/search"},e))};var x=function(){return a.createElement("div",null,a.createElement(f.c,{style:v},a.createElement(f.b,{container:!0,direction:"row",justify:"space-around",alignItems:"center"},a.createElement(f.b,{item:!0,sm:9,xs:8,style:{paddingTop:"20px",textAlign:"center"}},a.createElement(f.a,{component:y,className:S,variant:"contained",style:E.styleButton},"Load"),a.createElement(f.a,{component:w,className:S,variant:"contained",style:E.styleButton},"Search")))))},k=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={email:"",password:"",isRequesting:!1,isLoggedIn:!1,error:""},n.handleLogin=Object(s.a)(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{n.setState({error:""}),n.setState({isRequesting:!0}),n.setState({isLoggedIn:!0})}catch(t){n.setState({error:"Something went wrong"})}finally{n.setState({isRequesting:!1})}case 1:case"end":return e.stop()}},e)})),n.logout=function(){p(),n.setState({isLoggedIn:!1})},n.getTestData=Object(s.a)(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{n.setState({error:""})}catch(t){n.setState({error:"Something went wrong"})}finally{n.setState({isRequesting:!1})}case 1:case"end":return e.stop()}},e)})),n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.setState({isLoggedIn:g()})}},{key:"render",value:function(){return a.createElement("div",null,a.createElement(x,null),a.createElement("title",null,"Prodigium"),a.createElement("meta",{name:"description",content:""}),a.createElement("h1",null,"Prodigium Contact Search"))}},{key:"notUsed",value:function(){var e=this;return a.createElement("div",{className:"App"},a.createElement("header",{className:"App-header"},a.createElement("h1",{className:"App-title"},"Welcome to React")),a.createElement("div",{className:"App-error"},this.state.error),this.state.isLoggedIn?a.createElement("div",{className:"App-private"},a.createElement("div",null,"Server test data:"),a.createElement("button",{disabled:this.state.isRequesting,onClick:this.getTestData},"Get test data"),a.createElement("button",{disabled:this.state.isRequesting,onClick:this.logout},"Log out")):a.createElement("div",{className:"App-login"},"(try the credentials: testuser@email.com / my-password)",a.createElement("input",{disabled:this.state.isRequesting,placeholder:"email",type:"text",onChange:function(t){return e.setState({email:t.target.value})}}),a.createElement("input",{disabled:this.state.isRequesting,placeholder:"password",type:"password",onChange:function(t){return e.setState({password:t.target.value})}}),a.createElement("button",{disabled:this.state.isRequesting,onClick:this.handleLogin},"Log in")))}}]),t}(a.Component),O=n(52),N=n(33),j=n(9),F=n(110),D=n.n(F),I=n(17),L=(n(336),Object({NODE_ENV:"production",PUBLIC_URL:"."}).PORT||3300),A="http://localhost:".concat(L);function B(e){return R.apply(this,arguments)}function R(){return(R=Object(s.a)(c.a.mark(function e(t){var n,a,r,o,l=arguments;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:{},a={"Content-type":"application/json; charset=UTF-8"},console.log("sR: ".concat(A).concat(t)),e.next=5,fetch(encodeURI("".concat(A).concat(t)),Object.assign({method:"POST",credentials:"include"},{headers:a},n));case 5:return r=e.sent,e.next=8,r.json();case 8:if(!(o=e.sent).error){e.next=11;break}throw new Error(o.error);case 11:return console.log("sR got data: ",o),e.abrupt("return",o);case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function T(){return G.apply(this,arguments)}function G(){return(G=Object(s.a)(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getList: /categories"),e.next=3,B("/categories",{method:"GET"});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function M(){return P.apply(this,arguments)}function P(){return(P=Object(s.a)(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getLoadDate"),e.next=3,B("/loadDate",{method:"GET"});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function q(e){return W.apply(this,arguments)}function W(){return(W=Object(s.a)(c.a.mark(function e(t){var n,a;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(console.log("getContacts: /contacts"),n="",console.log("asSS: ",t),a=0;a<t.length-1;a++)console.log("string build: ",a,t[a]),n+=t[a],n+="@";return n+=t[a],console.log("string finish: ",a,t[a]),e.next=8,B("/contacts?q=".concat(n),{method:"GET"});case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}console.log("NODE_ENV: ".concat("production"," dev: ").concat(!0));var _;var U,V=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).fileInput=void 0,n.timeCounter=void 0,n.names=void 0,n.state=void 0,n.handleSubmit=n.handleSubmit.bind(Object(j.a)(n)),n.setState=n.setState.bind(Object(j.a)(n)),n.timeCounter=0,n.names=[],n.state={timeCounter:0,response:!1},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=Object(s.a)(c.a.mark(function e(){var t,n=this;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(t=D()()).on("news",function(e){console.log("something received: ",e);for(var a=JSON.parse(e.something),r=0;r<a.length;r++){var o={};o.id=r,o.GivenName=a[r].GivenName,o.FamilyName=a[r].FamilyName,n.names.push(o)}t.close(),window.clearInterval(_),n.setState(function(e){return Object(N.a)({},e,{response:!0})})});case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),console.log("load button"),console.log("props: ",this.props),console.log("state: ",this.state);var n=new FormData,a=this.fileInput.current.files[0].name;console.log("fname: ",a),n.append("avatar",this.fileInput.current.files[0]),n.append("clearDB",this.props.bClearDB.toString()),n.append("clearCats",this.props.bClearCats.toString()),n.append("csv",a.indexOf("csv")>0?"true":"false"),_=window.setInterval(function(){t.timeCounter++,t.setState({timeCounter:t.timeCounter})},1e3),fetch("/contacts/import",{method:"PUT",body:n}).then(function(e){return e.text()}).then(function(e){console.log("res: ",e)})}},{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("label",null,"Upload file:",r.a.createElement("input",{style:{width:"100%"},accept:".csv, .CSV, .vcf, .VCF",type:"file",ref:this.fileInput})),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("button",{type:"submit"},r.a.createElement("strong",null,"Submit")),r.a.createElement("div",null,this.state.response?r.a.createElement("div",null,r.a.createElement("p",null,"Loading done. Near-duplicates:"),(e=this.names,r.a.createElement(I.Table,{className:"table"},r.a.createElement(I.Thead,null,r.a.createElement(I.Th,{column:"firstName"},r.a.createElement("strong",{className:"name-header"},"First Name")),r.a.createElement(I.Th,{column:"lastName"},r.a.createElement("strong",{className:"name-header"},"Last Name"))),e.map(function(e){return r.a.createElement(I.Tr,null," ",r.a.createElement(I.Td,{column:"firstName"},e.GivenName)," ",r.a.createElement(I.Td,{column:"lastName"},e.FamilyName))})))):r.a.createElement("p",null,"Loading ",this.state.timeCounter)));var e}}]),t}(r.a.Component),H=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).handleInputChange=function(e){console.log("Input change",e.target.name,e.target.type,e.target.checked),n.setState(function(t){return Object(N.a)({},t,Object(O.a)({},e.target.name,e.target.checked))})},n.handleInputChange=n.handleInputChange.bind(Object(j.a)(n)),n.state={bClearCats:!1,bClearDB:!1,date:""},n.handleInputChange=n.handleInputChange.bind(Object(j.a)(n)),n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=Object(s.a)(c.a.mark(function e(){var t;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("CDM before gLD call"),e.next=4,M();case 4:t=e.sent,console.log("CDM:",t),this.setState({date:t}),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}},e,this,[[0,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e={width:"16px",height:"16px"};return r.a.createElement("strong",null,r.a.createElement("div",{style:{margin:"0 20px"}},x(),r.a.createElement("style",null,'\n      body {\n        background-image: url("/static/oriental.png");\n      }\n      '),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("h2",{style:{textAlign:"left"}},"Load contacts (last loaded ",this.state.date,")"),r.a.createElement("form",null,r.a.createElement("label",null,"Empty the database before loading: ",r.a.createElement("input",{style:e,name:"bClearDB",type:"checkbox",checked:this.state.bClearDB,onChange:this.handleInputChange})),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("label",null,"Rebuild the categories file: ",r.a.createElement("input",{style:e,name:"bClearCats",type:"checkbox",checked:this.state.bClearCats,onChange:this.handleInputChange})),r.a.createElement("br",null),r.a.createElement("br",null)),r.a.createElement(V,{bClearDB:this.state.bClearDB,bClearCats:this.state.bClearCats})))}}]),t}(r.a.Component),J=n(111),$=n.n(J),z=function e(){Object(i.a)(this,e),this.sSearch="",this.asSelect=[],this.bNext=!1,this.bAnd=!1,this.bSearch=!0,this.sSubCatOf="",this.iCatSearches=0,this.bComplete=!1,this.aoCatsList=[],this.sCat=[],this.bAllowMult=!1,this.iCatSearchesMax=0},K={bottom:0,left:20,right:0,maxWidth:600,maxHeight:350,backgroundColor:"rgba(0,0,0,0.3)",padding:50},Q={backgroundColor:"#fff",borderRadius:5,maxWidth:500,minHeight:200,margin:"0 auto",padding:30},X={margin:20,verticalAlign:"top",display:"inline-block"},Y={margin:20,verticalAlign:"top",display:"inline-block"},Z=[],ee=[];ee[0]=new z,ee[0].bNext=!0,console.log("aoS original length: ",ee.length);var te=[],ne=0,ae=[{key:"GivenName",name:"GivenName"},{key:"FamilyName",name:"FamilyName"}],re=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(m.a)(this,Object(h.a)(t).call(this,e))).state=void 0,n.catAddSelect=function(e,t){console.log("Need to debug this"),ee[t].sCat=[].filter.call(e.target.options,function(e){return e.selected}).map(function(e){return e.value}),console.log("catAddSelect: ",ee[t].sCat)},n.andButton=function(e){return function(){ee[e].bAnd=!1,ee[e].bSearch=!1,console.log("AND iCatSearches: ",ee[e].iCatSearches),ee[++ne-1]=new z,ee[ne-1].bNext=!0,n.setState({iCounter:n.state.iCounter++})}},n.nextButton=function(e){return function(){console.log("next button: ",e,ee[e].iCatSearches),ee[e].iCatSearches++,""!==ee[e].sSearch&&(ee[e].sSearch+=" _ "),ee[e].iCatSearches<3&&ee[e].sCat.length<2?(console.log("sCat: ",ee[e].sCat),console.log("sCat length: ",ee[e].sCat.length),ee[e].bComplete=!1,ee[e].iCatSearches>0&&(ee[e].bAnd=!0)):(ee[ne-1].bComplete=!0,ee[ne-1].bAnd=!1,ee[ne-1].bNext=!1,ee[ne-1].bSearch=!1,ee[++ne-1]=new z,ee[ne-1].bNext=!0),ee[e].sSearch+=ee[e].sCat.join(" OR "),console.log("searchString: ",ee[e].sSearch),ee[e].sSubCatOf=ee[e].sCat[0],console.log("asSubCatOf: ",ee[e].sCat[0]),U?n.searchButton():n.setState({iCounter:n.state.iCounter++})}},n.state={list:[],loading:!0,sAddCat:[],aoFound:[],iCounter:0,iPersonShow:-1},console.log("constructor aoFound: ",n.state.aoFound),n.nextButton=n.nextButton.bind(Object(j.a)(n)),n.andButton=n.andButton.bind(Object(j.a)(n)),n.searchButton=n.searchButton.bind(Object(j.a)(n)),Z[0]=0,n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"onClose",value:function(){}},{key:"ModalBox",value:function(e){return a.createElement("div",{className:"backdrop",style:K},a.createElement("div",{className:"modal",style:Q},a.createElement("div",null,a.createElement("p",null,te[e].GivenName," ",te[e].FamilyName)),a.createElement("p",null,void 0!==te[e].FC_ID1?a.createElement("a",{target:"_blank",href:te[e].url},a.createElement("strong",null,"FullContact")):""),a.createElement("p",null,te[e]["Phone1-Value"],"\xa0\xa0",te[e]["E-mail1-Value"]),a.createElement("br",null),a.createElement("img",{alt:"",style:{height:120},src:te[e].Photo1}),a.createElement("div",{className:"footer"})))}},{key:"rowSel",value:function(e){console.log("Row: ",e),this.setState({iPersonShow:e})}},{key:"handleClick",value:function(){}},{key:"handleClose",value:function(){this.setState({iPersonShow:-1})}},{key:"NameTable",value:function(e){var t=this;return a.createElement($.a,{minWidth:500,columns:ae,rowGetter:function(t){return e[t]},rowsCount:e.length,enableCellSelect:!0,onCellSelected:function(e){return t.rowSel(e.rowIdx)},minHeight:420})}},{key:"componentDidMount",value:function(){var e=Object(s.a)(c.a.mark(function e(){var t;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ne=1,U=!1,console.log("CDM before gL call"),e.next=6,T();case 6:t=e.sent,console.log("CDM:",t),this.setState({list:t,loading:!1}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),this.setState({loading:!1});case 14:case"end":return e.stop()}},e,this,[[0,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"searchButton",value:function(){var e=Object(s.a)(c.a.mark(function e(){var t,n,a,r,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(console.log("Search button"),U=!0,t=[],n=0;n<ne;n++)t[n]=ee[n].sSearch;return e.next=6,q(t);case 6:for(a=e.sent,console.log("aoFound: ",a.aoFound),this.setState({aoFound:a.aoFound}),r=0;r<a.aoFound.length;r++)(o={}).id=r,o=a.aoFound[r],te.push(o);return console.log(te),e.abrupt("return");case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"csr",value:function(e){for(var t=this,n=0;n<ne;n++){if(console.log("iTR, iRow, iCatSearches: ",ne,n,ee[n].iCatSearches),ee[n].aoCatsList=[],ee[n].iCatSearches<3){console.log("aoS[iR].sSCO: ",ee[n].sSubCatOf);for(var r=0,o=0;o<e.list.aoCats.length;o++)e.list.aoCats[o].sIsSubCatOf===ee[n].sSubCatOf&&(ee[n].aoCatsList.push(e.list.aoCats[o]),ee[n].aoCatsList[r].key=r++);ee[n].aoCatsList.sort(function(e,t){return e.sThisCat>t.sThisCat?1:-1})}ee[n].bAllowMult=""!==ee[n].sSubCatOf,ee[n].aoCatsList.length<2&&(console.log("short row: ",n,ee[n].aoCatsList.length),ee[n].bComplete=!0,ee[n].bNext=!1,ee[n].iCatSearchesMax=2)}var l=[];console.log("csr aoFound 1: ",e.aoFound),e.aoFound!==[]?(console.log("csr aoFound 2: ",e.aoFound),(l=e.aoFound).sort(function(e,t){return e.FamilyName>t.FamilyName?1:t.FamilyName>e.FamilyName?-1:e.GivenName>t.GivenName?1:t.GivenName>e.GivenName?-1:0})):l=[];for(var c=0;c<l.length;c++)l[c].url="https://app.fullcontact.com/contacts/".concat(l[c].FC_ID1,"/").concat(l[c].FC_ID2);return console.log("aoSearch len",ee.length),console.log("aoCatsList: ",ee[0].aoCatsList),a.createElement("div",{style:{textAlign:"center",margin:"0 20px"}},x(),a.createElement("h2",null,"Search page"),a.createElement("strong",null,ee.map(function(e,n){return a.createElement("div",{key:n},a.createElement("div",null,a.createElement("p",null,e.sSearch)),e.bComplete?"":a.createElement("div",null,a.createElement("select",{size:10,multiple:!!e.bAllowMult,onChange:function(e){return t.catAddSelect(e,n)}},e.aoCatsList.map(function(e,t){return a.createElement("option",{key:t}," ",e.sThisCat," ")}))),a.createElement("div",null,e.bNext?a.createElement("button",{onClick:t.nextButton(n)},"Next"):""),a.createElement("div",null,e.bAnd?a.createElement("button",{onClick:t.andButton(n)},"AND"):""),a.createElement("div",null,e.bSearch?a.createElement("button",{onClick:t.searchButton},"Search"):""))}),a.createElement("br",null),a.createElement("div",{style:X},l.length>0?this.NameTable(l):""),a.createElement("div",{style:Y},this.state.iPersonShow>=0?this.ModalBox(this.state.iPersonShow):""),a.createElement("div",null)))}},{key:"render",value:function(){return console.log("render CSRWD: |",Object(N.a)({},this.state)),a.createElement("div",null," ",this.csr(Object(N.a)({},this.state))," ")}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var oe=n(24);o.render(a.createElement(b.a,null,a.createElement(oe.c,null,a.createElement(oe.a,{exact:!0,path:"/",component:k}),a.createElement(oe.a,{path:"/load",component:H}),a.createElement(oe.a,{path:"/search",component:re}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},71:function(e,t,n){}},[[214,1,2]]]);
//# sourceMappingURL=main.22b4e0a3.chunk.js.map